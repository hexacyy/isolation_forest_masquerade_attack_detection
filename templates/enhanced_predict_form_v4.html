<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Real-World Masquerade Detection</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .context-box {
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 10px 0;
        }
        .risk-indicator {
            padding: 5px 10px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
        }
        .risk-low { background-color: #28a745; }
        .risk-medium { background-color: #ffc107; color: #000; }
        .risk-high { background-color: #dc3545; }
        .data-source {
            font-size: 0.9em;
            color: #6c757d;
            font-style: italic;
        }
        .scenario-card {
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
        }
        .scenario-card:hover {
            border-color: #007bff;
            transform: translateY(-2px);
        }
        .scenario-card.active {
            border-color: #28a745;
            background-color: #f8f9fa;
        }
    </style>
</head>
<body class="bg-light">
    {% include 'navbar.html' %}
    
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <div class="container mt-2">
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        </div>
    {% endif %}
    {% endwith %}

    <div class="container py-4">
        <h1 class="mb-4">üîç Corporate Network Security Analysis</h1>
        
        <!-- Scenario Context -->
        <div class="context-box">
            <h5>üìä Security Operations Center (SOC) - Live Session Analysis</h5>
            <p><strong>Mission:</strong> Analyze suspicious login attempts to corporate systems. You are reviewing session data collected from various security tools to detect potential masquerade attacks.</p>
            <div class="row">
                <div class="col-md-6">
                    <h6>Data Sources:</h6>
                    <ul class="mb-0">
                        <li>üåê <strong>Firewall Logs:</strong> Network traffic analysis</li>
                        <li>üîê <strong>Authentication Server:</strong> Login attempt records</li>
                        <li>üõ°Ô∏è <strong>Threat Intelligence:</strong> IP reputation feeds</li>
                        <li>‚è∞ <strong>SIEM System:</strong> Behavioral baselines</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h6>Business Context:</h6>
                    <ul class="mb-0">
                        <li>üìÖ <strong>Business Hours:</strong> 9:00 AM - 5:00 PM</li>
                        <li>üë• <strong>User Types:</strong> Admins (high privilege), Viewers (limited access)</li>
                        <li>üö® <strong>Alert Threshold:</strong> Risk score ‚â• 0.8 triggers immediate response</li>
                        <!-- <li>üí∞ <strong>Breach Cost:</strong> $50K average per successful attack</li> -->
                    </ul>
                </div>
            </div>
        </div>

        <!-- Real-Time Status Dashboard -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6 class="card-title">üïê Current Time</h6>
                        <div id="current-time" class="h5"></div>
                        <div id="business-hours" class="text-muted"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6 class="card-title">üìä Network Load</h6>
                        <div id="network-load" class="h5">Medium</div>
                        <div class="text-muted">Current traffic</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6 class="card-title">üéØ Threat Level</h6>
                        <span id="threat-level" class="risk-indicator risk-low">LOW</span>
                        <div class="text-muted mt-2">Based on intel feeds</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6 class="card-title">üìà Detection Rate</h6>
                        <div class="h5 text-success">87.3%</div>
                        <div class="text-muted">Model accuracy</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Realistic Scenarios -->
        <div class="card mb-4">
            <div class="card-header">
                <h5>üé≠ Load Realistic Security Scenarios</h5>
                <p class="mb-0">Click on a scenario to load realistic data patterns from actual security incidents</p>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card scenario-card" onclick="loadScenario('normal')">
                            <div class="card-body text-center">
                                <div class="display-6 text-success">‚úÖ</div>
                                <h6>Normal Employee</h6>
                                <p class="small text-muted">Mary (Viewer) accessing system during business hours with clean IP</p>
                                <div class="badge bg-success">Expected: Normal</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card scenario-card" onclick="loadScenario('suspicious')">
                            <div class="card-body text-center">
                                <div class="display-6 text-warning">‚ö†Ô∏è</div>
                                <h6>Suspicious Activity</h6>
                                <p class="small text-muted">Off-hours access with multiple failed logins from unknown IP</p>
                                <div class="badge bg-warning">Expected: Investigate</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card scenario-card" onclick="loadScenario('masquerade')">
                            <div class="card-body text-center">
                                <div class="display-6 text-danger">üö®</div>
                                <h6>Masquerade Attack</h6>
                                <p class="small text-muted">Known malicious IP attempting credential stuffing attack</p>
                                <div class="badge bg-danger">Expected: Block</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Analysis Form -->
        <form id="masquerade-form" class="card" method="POST">
            <div class="card-header">
                <h5>üìã Session Security Analysis</h5>
                <p class="mb-0">Analyze captured session data for potential masquerade attacks</p>
            </div>
            <div class="card-body">
                
                <!-- User Context Section -->
                <h6 class="border-bottom pb-2 mb-3">üë§ User & Session Context</h6>
                <div class="row mb-3">
                    <div class="col-md-4">
                        <label class="form-label">User Account</label>
                        <select class="form-select" name="user_role" id="user_role">
                            <option value="Admin" {% if form_data.user_role == 'Admin' %}selected{% endif %}>john.admin@company.com (Admin)</option>
                            <option value="Viewer" {% if form_data.user_role == 'Viewer' %}selected{% endif %}>mary.user@company.com (Viewer)</option>
                        </select>
                        <div class="data-source">Source: Active Directory</div>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Traffic Profile</label>
                        <select class="form-select" name="selected_profile" id="selected_profile">
                            <option value="Low" {% if selected_profile == 'Low' %}selected{% endif %}>Low Traffic Period</option>
                            <option value="Medium" {% if selected_profile == 'Medium' %}selected{% endif %}>Medium Traffic Period</option>
                            <option value="High" {% if selected_profile == 'High' %}selected{% endif %}>High Traffic Period</option>
                        </select>
                        <div class="data-source">Source: Network monitoring</div>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Session Time</label>
                        <input type="time" class="form-control" name="access_time" id="access_time" value="{{ form_data.access_time or '14:00' }}">
                        <div class="data-source">Source: Authentication logs</div>
                    </div>
                </div>

                <!-- Network Analysis Section -->
                <h6 class="border-bottom pb-2 mb-3">üåê Network Behavior Analysis</h6>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Average Packet Size (bytes)</label>
                        <input type="number" class="form-control" name="network_packet_size" id="network_packet_size" 
                               value="{{ form_data.network_packet_size or 500 }}" min="64" max="1518">
                        <div class="data-source">Source: Network packet capture (typical: 64-1518 bytes)</div>
                        <div class="form-text">
                            <small>Normal ranges: Admin(800-1200), Viewer(200-600)</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Session Duration (seconds)</label>
                        <input type="number" class="form-control" name="session_duration" id="session_duration" 
                               value="{{ form_data.session_duration or 1800 }}" min="30">
                        <div class="data-source">Source: Session management system</div>
                        <div class="form-text">
                            <small>Typical: Admin(3600s), Viewer(1800s), Suspicious(<300s)</small>
                        </div>
                    </div>
                </div>

                <!-- Authentication Analysis Section -->
                <h6 class="border-bottom pb-2 mb-3">üîê Authentication Pattern Analysis</h6>
                <div class="row mb-3">
                    <div class="col-md-4">
                        <label class="form-label">Total Login Attempts</label>
                        <input type="number" class="form-control" name="login_attempts" id="login_attempts" 
                               value="{{ form_data.login_attempts or 1 }}" min="1" max="20">
                        <div class="data-source">Source: Authentication server logs</div>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Failed Login Attempts</label>
                        <input type="number" class="form-control" name="failed_logins" id="failed_logins" 
                               value="{{ form_data.failed_logins or 0 }}" min="0">
                        <div class="data-source">Source: Security event logs</div>
                        <div class="form-text">
                            <small class="text-danger">‚ö†Ô∏è Red flag if ‚â• 3 failures</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Source IP Address</label>
                        <input type="text" class="form-control" name="source_ip" id="source_ip" 
                               value="203.0.113.1" placeholder="e.g., 192.168.1.100">
                        <div class="data-source">Source: Network access logs</div>
                        <div id="ip-analysis" class="mt-1"></div>
                    </div>
                </div>

                <!-- Risk Assessment Section -->
                <h6 class="border-bottom pb-2 mb-3">‚ö†Ô∏è Risk Indicators</h6>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">IP Reputation Score (0.0 = Clean, 1.0 = Malicious)</label>
                        <input type="range" class="form-range" name="ip_reputation_score" id="ip_reputation_score" 
                               min="0" max="1" step="0.01" value="{{ form_data.ip_reputation_score or 0.1 }}">
                        <div class="d-flex justify-content-between">
                            <small class="text-success">Clean (0.0)</small>
                            <small id="reputation-value" class="fw-bold">0.1</small>
                            <small class="text-danger">Malicious (1.0)</small>
                        </div>
                        <div class="data-source">Source: VirusTotal, AbuseIPDB threat feeds</div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Access Timing Analysis</label>
                        <div class="form-check form-switch mt-2">
                            <input class="form-check-input" type="checkbox" name="unusual_time_access" id="unusual_time_access">
                            <label class="form-check-label" for="unusual_time_access">
                                Outside business hours (9 AM - 5 PM weekdays)
                            </label>
                        </div>
                        <div class="data-source">Source: Timestamp analysis vs business hours</div>
                        <div class="form-text">
                            <small>Auto-calculated based on session time</small>
                        </div>
                    </div>
                </div>

                <!-- Technical Details Section (Collapsed by default) -->
                <div class="accordion mb-3">
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#technical-details">
                                üîß Advanced Technical Parameters
                            </button>
                        </h2>
                        <div id="technical-details" class="accordion-collapse collapse">
                            <div class="accordion-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        <label class="form-label">Network Protocol</label>
                                        <select class="form-select" name="protocol_primary" id="protocol_primary">
                                            <option value="TCP" selected>TCP (Web/Email)</option>
                                            <option value="UDP">UDP (VoIP/Gaming)</option>
                                            <option value="ICMP">ICMP (Network)</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Encryption Method</label>
                                        <select class="form-select" name="encryption_primary" id="encryption_primary">
                                            <option value="AES" selected>AES-256 (Strong)</option>
                                            <option value="DES">DES (Legacy/Weak)</option>
                                            <option value="None">None (Unencrypted)</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Browser/Client</label>
                                        <select class="form-select" name="browser_primary" id="browser_primary">
                                            <option value="Chrome" selected>Chrome</option>
                                            <option value="Firefox">Firefox</option>
                                            <option value="Safari">Safari</option>
                                            <option value="Edge">Edge</option>
                                            <option value="Unknown">Unknown/Automated</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <!-- Hidden fields for model compatibility -->
                                <input type="hidden" name="protocol_type_TCP" id="protocol_type_TCP" value="1">
                                <input type="hidden" name="protocol_type_UDP" id="protocol_type_UDP" value="0">
                                <input type="hidden" name="protocol_type_ICMP" id="protocol_type_ICMP" value="0">
                                <input type="hidden" name="encryption_used_AES" id="encryption_used_AES" value="1">
                                <input type="hidden" name="encryption_used_DES" id="encryption_used_DES" value="0">
                                <input type="hidden" name="browser_type_Chrome" id="browser_type_Chrome" value="1">
                                <input type="hidden" name="browser_type_Firefox" id="browser_type_Firefox" value="0">
                                <input type="hidden" name="browser_type_Safari" id="browser_type_Safari" value="0">
                                <input type="hidden" name="browser_type_Edge" id="browser_type_Edge" value="0">
                                <input type="hidden" name="browser_type_Unknown" id="browser_type_Unknown" value="0">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Real-time Risk Assessment Display -->
                <div class="alert alert-info" role="alert">
                    <h6>üìä Real-time Risk Assessment</h6>
                    <div id="risk-breakdown">
                        <div class="row">
                            <div class="col-md-6">
                                <div>üîç IP Reputation Risk: <span id="ip-risk" class="badge bg-success">Low</span></div>
                                <div>‚ùå Authentication Risk: <span id="auth-risk" class="badge bg-success">Low</span></div>
                            </div>
                            <div class="col-md-6">
                                <div>‚è∞ Timing Risk: <span id="time-risk" class="badge bg-success">Low</span></div>
                                <div><strong>üìà Overall Risk Score: <span id="overall-risk" class="badge bg-success">0.10</span></strong></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="d-grid">
                    <button type="submit" class="btn btn-primary btn-lg">
                        üîç Analyze Session for Masquerade Attack
                    </button>
                </div>
            </div>
        </form>

        <!-- Results Section -->
        {% if result %}
        <div class="card mt-4">
            <div class="card-header">
                <h5>üìà Security Analysis Results</h5>
            </div>
            <div class="card-body">
                <div class="alert {% if result.anomaly == 1 %}alert-danger{% else %}alert-success{% endif %}" role="alert">
                    <div class="d-flex align-items-center">
                        <div class="display-6 me-3">
                            {% if result. anomaly == 1 %}üö®{% else %}‚úÖ{% endif %}
                        </div>
                        <div>
                            <h4 class="alert-heading mb-1">
                                {% if result.anomaly == 1 %}
                                    MASQUERADE ATTACK DETECTED
                                {% else %}
                                    LEGITIMATE SESSION CONFIRMED
                                {% endif %}
                            </h4>
                            <p class="mb-0"><strong>Confidence:</strong> {{ result.confidence or 'High' }}</p>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <h6>üîç Technical Analysis</h6>
                        <ul>
                            <li><strong>Risk Score:</strong> {{ "%.3f"|format(result.risk_score or 0) }}</li>
                            <li><strong>ML Decision:</strong> {{ result.explanation or 'Analysis complete' }}</li>
                            <li><strong>Model Type:</strong> Isolation Forest (Anomaly Detection)</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>üíº Business Impact</h6>
                        <ul>
                            <li><strong>Security Response:</strong> 
                                {% if result.anomaly == 1 %}
                                    Immediate investigation required
                                {% else %}
                                    Continue normal monitoring
                                {% endif %}
                            </li>
                            <li><strong>Estimated Cost Impact:</strong> 
                                {% if result.anomaly == 1 %}
                                    Prevented $50K potential breach
                                {% else %}
                                    $0 - Normal operations
                                {% endif %}
                            </li>
                        </ul>
                    </div>
                </div>
                
                {% if result.anomaly == 1 %}
                <div class="alert alert-warning mt-3">
                    <h6>üö® Recommended Immediate Actions:</h6>
                    <ul class="mb-0">
                        <li>üîí Suspend user account pending investigation</li>
                        <li>üö´ Block source IP at firewall level</li>
                        <li>üìû Contact user via alternate method to verify legitimacy</li>
                        <li>üìß Alert security team and document incident</li>
                    </ul>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Real-time clock and business hours
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString();
            const hour = now.getHours();
            const day = now.getDay(); // 0 = Sunday, 6 = Saturday
            const isBusinessHours = hour >= 9 && hour < 17 && day >= 1 && day <= 5;
            
            document.getElementById('current-time').textContent = timeStr;
            document.getElementById('business-hours').textContent = isBusinessHours ? 
                '‚úÖ Business Hours' : '‚ö†Ô∏è Outside Business Hours';
            
            // Auto-update unusual time checkbox
            const timeInput = document.getElementById('access_time').value;
            if (timeInput) {
                const inputHour = parseInt(timeInput.split(':')[0]);
                const isUnusual = inputHour < 9 || inputHour >= 17;
                document.getElementById('unusual_time_access').checked = isUnusual;
            }
            
            updateRiskAssessment();
        }

        // IP Analysis
        function analyzeIP() {
            const ip = document.getElementById('source_ip').value;
            const ipAnalysis = document.getElementById('ip-analysis');
            const reputationSlider = document.getElementById('ip_reputation_score');
            
            // Known patterns for demo
            const maliciousIPs = ['45.33.32.156', '87.120.37.155', '185.220.101.32'];
            const corporateIPs = ['203.0.113.1', '198.51.100.5', '192.0.2.146'];
            
            if (maliciousIPs.includes(ip)) {
                ipAnalysis.innerHTML = '<span class="badge bg-danger">‚ö†Ô∏è KNOWN MALICIOUS IP</span>';
                reputationSlider.value = 0.9;
            } else if (corporateIPs.includes(ip) || ip.startsWith('10.') || ip.startsWith('192.168.')) {
                ipAnalysis.innerHTML = '<span class="badge bg-success">‚úÖ TRUSTED/CORPORATE IP</span>';
                reputationSlider.value = 0.05;
            } else {
                ipAnalysis.innerHTML = '<span class="badge bg-warning">‚ùì UNKNOWN EXTERNAL IP</span>';
                reputationSlider.value = 0.4;
            }
            
            updateReputationValue();
        }

        // Update reputation display
        function updateReputationValue() {
            const value = parseFloat(document.getElementById('ip_reputation_score').value);
            document.getElementById('reputation-value').textContent = value.toFixed(2);
            updateRiskAssessment();
        }

        // Real-time risk assessment
        function updateRiskAssessment() {
            const ipRep = parseFloat(document.getElementById('ip_reputation_score').value);
            const failedLogins = parseInt(document.getElementById('failed_logins').value) || 0;
            const unusualTime = document.getElementById('unusual_time_access').checked ? 1 : 0;
            
            // Calculate risk components (matching your model)
            const overallRisk = (ipRep * 0.5) + (failedLogins * 0.2) + (unusualTime * 0.3);
            
            // Update individual risk indicators
            updateRiskBadge('ip-risk', ipRep, [0.3, 0.7]);
            updateRiskBadge('auth-risk', failedLogins, [1, 3]);
            updateRiskBadge('time-risk', unusualTime, [0.5, 0.8]);
            updateRiskBadge('overall-risk', overallRisk, [0.3, 0.7]);
            
            // Update threat level
            const threatLevel = document.getElementById('threat-level');
            if (overallRisk < 0.3) {
                threatLevel.className = 'risk-indicator risk-low';
                threatLevel.textContent = 'LOW';
            } else if (overallRisk < 0.7) {
                threatLevel.className = 'risk-indicator risk-medium';
                threatLevel.textContent = 'MEDIUM';
            } else {
                threatLevel.className = 'risk-indicator risk-high';
                threatLevel.textContent = 'HIGH';
            }
        }

        function updateRiskBadge(elementId, value, thresholds) {
            const element = document.getElementById(elementId);
            const displayValue = elementId === 'overall-risk' ? value.toFixed(2) : 
                               (elementId === 'auth-risk' ? value : (value > 0 ? 'Yes' : 'No'));
            
            if (value < thresholds[0]) {
                element.className = 'badge bg-success';
                element.textContent = elementId === 'overall-risk' ? displayValue : 'Low';
            } else if (value < thresholds[1]) {
                element.className = 'badge bg-warning';
                element.textContent = elementId === 'overall-risk' ? displayValue : 'Medium';
            } else {
                element.className = 'badge bg-danger';
                element.textContent = elementId === 'overall-risk' ? displayValue : 'High';
            }
        }

        // Load realistic scenarios
        function loadScenario(type) {
            // Remove active class from all cards
            document.querySelectorAll('.scenario-card').forEach(card => {
                card.classList.remove('active');
            });
            
            // Add active class to clicked card
            event.currentTarget.classList.add('active');
            
            const scenarios = {
                normal: {
                    user_role: 'Viewer',
                    selected_profile: 'Medium',
                    access_time: '14:30',
                    network_packet_size: 450,
                    session_duration: 1800,
                    login_attempts: 1,
                    failed_logins: 0,
                    source_ip: '203.0.113.1',
                    ip_reputation_score: 0.05,
                    unusual_time_access: false,
                    protocol_primary: 'TCP',
                    encryption_primary: 'AES',
                    browser_primary: 'Chrome'
                },
                suspicious: {
                    user_role: 'Viewer',
                    selected_profile: 'Low',
                    access_time: '23:15',
                    network_packet_size: 1200,
                    session_duration: 300,
                    login_attempts: 4,
                    failed_logins: 3,
                    source_ip: '198.51.100.10',
                    ip_reputation_score: 0.65,
                    unusual_time_access: true,
                    protocol_primary: 'TCP',
                    encryption_primary: 'DES',
                    browser_primary: 'Unknown'
                },
                masquerade: {
                    user_role: 'Admin',
                    selected_profile: 'High',
                    access_time: '02:30',
                    network_packet_size: 64,
                    session_duration: 120,
                    login_attempts: 6,
                    failed_logins: 5,
                    source_ip: '45.33.32.156',
                    ip_reputation_score: 0.92,
                    unusual_time_access: true,
                    protocol_primary: 'UDP',
                    encryption_primary: 'None',
                    browser_primary: 'Unknown'
                }
            };
            
            const scenario = scenarios[type];
            if (scenario) {
                // Fill form fields
                Object.keys(scenario).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = scenario[key];
                        } else {
                            element.value = scenario[key];
                        }
                    }
                });
                
                // Update protocol/encryption/browser hidden fields
                updateTechnicalFields();
                analyzeIP();
                updateRiskAssessment();
            }
        }

        // Update hidden technical fields based on dropdowns
        function updateTechnicalFields() {
            // Protocol fields
            const protocol = document.getElementById('protocol_primary').value;
            document.getElementById('protocol_type_TCP').value = protocol === 'TCP' ? '1' : '0';
            document.getElementById('protocol_type_UDP').value = protocol === 'UDP' ? '1' : '0';
            document.getElementById('protocol_type_ICMP').value = protocol === 'ICMP' ? '1' : '0';
            
            // Encryption fields
            const encryption = document.getElementById('encryption_primary').value;
            document.getElementById('encryption_used_AES').value = encryption === 'AES' ? '1' : '0';
            document.getElementById('encryption_used_DES').value = encryption === 'DES' ? '1' : '0';
            
            // Browser fields
            const browser = document.getElementById('browser_primary').value;
            document.getElementById('browser_type_Chrome').value = browser === 'Chrome' ? '1' : '0';
            document.getElementById('browser_type_Firefox').value = browser === 'Firefox' ? '1' : '0';
            document.getElementById('browser_type_Safari').value = browser === 'Safari' ? '1' : '0';
            document.getElementById('browser_type_Edge').value = browser === 'Edge' ? '1' : '0';
            document.getElementById('browser_type_Unknown').value = browser === 'Unknown' ? '1' : '0';
        }

        // Event listeners
        document.getElementById('source_ip').addEventListener('input', analyzeIP);
        document.getElementById('ip_reputation_score').addEventListener('input', updateReputationValue);
        document.getElementById('failed_logins').addEventListener('input', updateRiskAssessment);
        document.getElementById('access_time').addEventListener('change', updateRiskAssessment);
        document.getElementById('unusual_time_access').addEventListener('change', updateRiskAssessment);
        
        // Technical field updates
        document.getElementById('protocol_primary').addEventListener('change', updateTechnicalFields);
        document.getElementById('encryption_primary').addEventListener('change', updateTechnicalFields);
        document.getElementById('browser_primary').addEventListener('change', updateTechnicalFields);

        // Initialize
        setInterval(updateTime, 1000);
        updateTime();
        analyzeIP();
        updateTechnicalFields();
    </script>
</body>
</html>